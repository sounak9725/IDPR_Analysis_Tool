<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}IPDR Analysis Dashboard{% endblock %}</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- D3.js for network visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --dark-bg: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-light: #ffffff;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark-bg) 0%, #2c3e50 100%);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        
        .navbar {
            background: rgba(44, 62, 80, 0.95) !important;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .navbar-brand {
            color: var(--secondary-color) !important;
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .nav-link {
            color: var(--text-light) !important;
            transition: color 0.3s ease;
        }
        
        .nav-link:hover {
            color: var(--secondary-color) !important;
        }
        
        .card {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }
        
        .card-header {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px 15px 0 0 !important;
            color: white;
            font-weight: bold;
        }
        
        .stat-card {
            text-align: center;
            padding: 1.5rem;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--secondary-color), #2980b9);
            border: none;
            border-radius: 25px;
            padding: 10px 25px;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .search-box {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            color: var(--text-light);
            padding: 12px 20px;
        }
        
        .search-box:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
            color: var(--text-light);
        }
        
        .search-box::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .alert {
            border-radius: 10px;
            border: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .spinner-border {
            color: var(--secondary-color);
        }
        
        .network-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 1rem;
            height: 600px;
            overflow: hidden;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
        }
        
        .suspicious-high { color: var(--accent-color); }
        .suspicious-medium { color: var(--warning-color); }
        .suspicious-low { color: var(--success-color); }
        
        .footer {
            background: rgba(44, 62, 80, 0.8);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 0;
            margin-top: 3rem;
        }
        
        /* Ensure all text is white and visible */
        body, body * {
            color: var(--text-light) !important;
        }
        
        /* Override any Bootstrap text colors */
        .text-muted, .text-secondary {
            color: var(--text-light) !important;
            opacity: 0.8;
        }
        
        /* Ensure form elements have white text */
        input, textarea, select {
            color: var(--text-light) !important;
        }
        
        /* Ensure table text is white */
        table, th, td {
            color: var(--text-light) !important;
        }
        
        /* Ensure list text is white */
        ul, ol, li {
            color: var(--text-light) !important;
        }
        
        /* Ensure paragraph text is white */
        p {
            color: var(--text-light) !important;
        }
        
        /* Ensure heading text is white */
        h1, h2, h3, h4, h5, h6 {
            color: var(--text-light) !important;
        }
        
        /* Ensure label text is white */
        label {
            color: var(--text-light) !important;
        }
        
        /* Ensure small text is white */
        small {
            color: var(--text-light) !important;
            opacity: 0.8;
        }
        
        /* Ensure span text is white */
        span {
            color: var(--text-light) !important;
        }
        
        /* Ensure div text is white */
        div {
            color: var(--text-light) !important;
        }
        
        /* Override all Chart.js text colors to white */
        canvas {
            color: var(--text-light) !important;
        }
        
        /* Ensure all chart text elements are white */
        .chartjs-chart * {
            color: var(--text-light) !important;
        }
        
        /* Override any remaining Bootstrap or default text colors */
        .text-dark, .text-body {
            color: var(--text-light) !important;
        }
        
        /* Ensure form labels and inputs are white */
        .form-label, .form-control, .form-select {
            color: var(--text-light) !important;
        }
        
        /* Ensure table text is white */
        .table, .table th, .table td {
            color: var(--text-light) !important;
        }
        
        /* Ensure modal text is white */
        .modal-title, .modal-body, .modal-footer {
            color: var(--text-light) !important;
        }
        
        /* Override modal text colors for better visibility */
        .modal-content {
            color: #000000 !important;
        }
        
        .modal-content .modal-title,
        .modal-content .modal-body,
        .modal-content .modal-footer,
        .modal-content label,
        .modal-content input,
        .modal-content textarea,
        .modal-content select,
        .modal-content .form-label,
        .modal-content .form-control,
        .modal-content .form-select {
            color: #000000 !important;
        }
        
        /* Ensure modal buttons have proper text color */
        .modal-content .btn {
            color: inherit !important;
        }
        
        .modal-content .btn-secondary {
            color: #ffffff !important;
        }
        
        .modal-content .btn-primary {
            color: #ffffff !important;
        }
        
        /* Additional modal styling for better visibility */
        .modal-header,
        .modal-body,
        .modal-footer {
            background-color: #ffffff !important;
        }
        
        .modal-header .modal-title {
            color: #000000 !important;
        }
        
        /* Ensure form elements in modals are readable */
        .modal .form-control::placeholder {
            color: #6c757d !important;
        }
        
        .modal .form-control:focus {
            color: #000000 !important;
        }
        
        /* Override any conflicting Bootstrap modal styles */
        .modal.show .modal-dialog {
            color: #000000 !important;
        }
        
        /* Use dark text for alerts to ensure readability on light alert backgrounds */
        .alert {
            color: #000000 !important;
        }
        .alert * {
            color: #000000 !important;
        }
        .alert .alert-heading,
        .alert p,
        .alert strong { color: #000000 !important; }
        .alert .suspicious-high,
        .alert .suspicious-medium,
        .alert .suspicious-low { color: #000000 !important; }
        
        /* Ensure badge text is white */
        .badge {
            color: var(--text-light) !important;
        }
        
        /* Network controls specific styling for better visibility */
        .network-controls,
        .network-controls *,
        .network-controls label,
        .network-controls .form-label {
            color: #ffffff !important;
        }
        
        /* Network form controls with white backgrounds */
        .network-controls .form-control,
        .network-controls .form-select,
        .network-controls input,
        .network-controls select {
            color: #000000 !important;
            background-color: #ffffff !important;
        }
        
        /* Network control labels and text */
        .network-controls h5,
        .network-controls h6,
        .network-controls p,
        .network-controls span,
        .network-controls div {
            color: #000000 !important;
        }
        
        /* Explicit exceptions for light UI controls (dataset selector) */
        .dataset-select,
        .dataset-select *,
        .dataset-select option {
            color: #000000 !important;
            background-color: #ffffff !important;
        }

        /* Network statistics cards - keep white text on dark background */
        .network-stats .stat-card,
        .network-stats .stat-number,
        .network-stats .stat-label {
            color: var(--text-light) !important;
        }
        
        /* Override for any network-related form elements */
        .network-page .form-control,
        .network-page .form-select,
        .network-page input,
        .network-page select {
            color: #000000 !important;
            background-color: #ffffff !important;
        }
        
        .network-page label,
        .network-page .form-label {
            color: #000000 !important;
        }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-shield-alt me-2"></i>
                IPDR Analysis
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            <i class="fas fa-tachometer-alt me-1"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/enhanced-analysis">
                            <i class="fas fa-shield-alt me-1"></i>
                            Enhanced Analysis
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/advanced-filtering">
                            <i class="fas fa-filter me-1"></i>
                            Advanced Filtering
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/case-management">
                            <i class="fas fa-folder-open me-1"></i>
                            Case Management
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/investigation">
                            <i class="fas fa-search me-1"></i>
                            Investigation
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/network">
                            <i class="fas fa-project-diagram me-1"></i>
                            Network
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/patterns">
                            <i class="fas fa-chart-line me-1"></i>
                            Patterns
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/contributors">
                            <i class="fas fa-users me-1"></i>
                            Contributors
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container-fluid py-4">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container text-center">
            <p class="mb-0">
                <i class="fas fa-code me-1"></i>
                IPDR Analysis Tool - Hackathon 2024
            </p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Socket.IO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    
    <script>
        // Global utility functions
        function showLoading() {
            document.querySelector('.loading').style.display = 'block';
        }
        
        function hideLoading() {
            document.querySelector('.loading').style.display = 'none';
        }
        
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.querySelector('main').insertBefore(alertDiv, document.querySelector('main').firstChild);
            
            // Auto-dismiss after 5 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }
        
        function formatNumber(num) {
            return new Intl.NumberFormat().format(num);
        }
        
        function formatDuration(seconds) {
            if (seconds < 60) return `${seconds}s`;
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ${seconds % 60}s`;
            return `${Math.floor(seconds / 3600)}h ${Math.floor((seconds % 3600) / 60)}m`;
        }
        
        // Global Chart.js configuration to ensure white text
        if (typeof Chart !== 'undefined') {
            Chart.defaults.color = '#ffffff';
            Chart.defaults.plugins.legend.labels.color = '#ffffff';
            Chart.defaults.scales.x.ticks.color = '#ffffff';
            Chart.defaults.scales.y.ticks.color = '#ffffff';
        }
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
